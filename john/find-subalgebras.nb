(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     34084,        924]
NotebookOptionsPosition[     32759,        875]
NotebookOutlinePosition[     33138,        892]
CellTagsIndexPosition[     33095,        889]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "tools.m"}], ";"}]}], "Input",
 CellChangeTimes->{{3.710544703731085*^9, 3.7105447218174133`*^9}, {
  3.710545037599579*^9, 3.710545040249243*^9}, {3.710545086638508*^9, 
  3.7105450892339478`*^9}}],

Cell[CellGroupData[{

Cell["Generating and Labeling Subalgebras", "Title",
 CellChangeTimes->{{3.710257129383018*^9, 3.710257137510057*^9}}],

Cell[BoxData[
 RowBox[{"\"\<\nsubalg[type_][clusters_]:= lists all subalgebras of `type` \
wholly contained in `clusters`.\n\nsubpoly[type_][clusters_]:= lists all \
subpolytopes of `type` wholly contained in\nthe Stasheff polytope of \
`clusters`.\n\nIt is important to distinguish between subalgebras and \
subpolytopes, as the same \nsubalgebra can 'generate' multiple distinct \
subpolytopes. For example, x1->x2 is clearly an\nA2 subalgebra of \
x1->x2->x3->x4. However there is not a unique pentagon of the A4 Stasheff \n\
polytope associated with this A2. Instead, there are two: the one from \
mutating at nodes 1 \nand 2 of the seed x1->x2->x3->x4, and the one from \
mutating at nodes 1 and 2 of the \ncluster x1->x2->x3(1+x4)->1/x4. (Using the \
notation described below, these pentagons are \nlabeled by ()[12] and \
(4)[12], respectively).  \n\nTherefore subalg is a subset of subpoly. I have \
chosen the representative of each \nequivalence class simply by Sort[]-ing \
and then taking the first element. Hopefully we \ncan use this as the \
canonical notation for labeling subalgebras. \n\nAcceptable `type`s are: a2, \
a1a1, etc... no need to enter them as strings.\n\nImportant: in all of the \
code that follows it is necessary that clusters come with coords. \n\n\
Subalgebras are written at the end of a coord, for example {1,2,3,a2a2[4,2]}.\
\n\nNote that subalgebras generated from the origin, i.e. coord {}, will look \
a little funny. \nFor example, in x1->x2->x3, the A1 x A1 generated by x1 and \
x3 is written as {a1a1[1,3]}.\n\nFor the purpose of writing emails and in \
papers I propose the notation (coord)[subalg]:\n\n(123)[25] is an A2 \
subalgebra starting at coord (123) and generated by nodes 2 & 5\n(123)[25,43] \
is an A2 x A2 subalgebra starting at coord (123) with A2's 2->5 and 4->3\n\n\
For Dn algebras we'll use a '/' to delineate the 'A(n-2)' portion from  the \
'prongs', \ne.g. (123)[61/24] for the D4 subalgebra with 6->1,1->2,1->4.\n\n\
\>\"", ";"}]], "Input",
 CellChangeTimes->{{3.7102571568717747`*^9, 3.710257295889076*^9}, {
  3.710257344387957*^9, 3.710257378511601*^9}, {3.710257478227352*^9, 
  3.710257641731586*^9}, {3.710257777387521*^9, 3.710258166129319*^9}, {
  3.710258482368939*^9, 3.710258986137166*^9}, {3.710490165611559*^9, 
  3.71049031871729*^9}, {3.710490349228387*^9, 3.7104904299822493`*^9}, {
  3.710495061964425*^9, 3.7104950672006683`*^9}, {3.710539710707017*^9, 
  3.7105397117916317`*^9}, {3.7105437710303373`*^9, 3.710543902343799*^9}, {
  3.710543967305112*^9, 3.710543967869484*^9}, {3.710699076170535*^9, 
  3.710699079779811*^9}, {3.710699134490131*^9, 3.710699260537002*^9}, {
  3.7107769788937197`*^9, 3.710777711929761*^9}, {3.710778764683098*^9, 
  3.71077880321568*^9}, {3.710779074437669*^9, 3.7107790837202578`*^9}, {
  3.710779150413183*^9, 3.710779282203216*^9}, {3.710779316825988*^9, 
  3.710779378972012*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"subsCanonSeeded", "[", "algSeed_", "]"}], "[", "cluster_", 
     "]"}], ":=", " ", 
    RowBox[{
    "finds", " ", "subsets", " ", "of", " ", "`cluster`", " ", "that", " ", 
     "are", " ", "in", " ", 
     RowBox[{"the", " ", "'"}], 
     RowBox[{"canonical", "'"}], " ", "form", "\n", "of", " ", "a", " ", 
     "subalgebra", " ", "of", " ", "type", " ", "`algSeed`", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"'", 
        RowBox[{"canonical", "'"}], " ", "form", " ", "means", " ", "x1"}], "->", 
       RowBox[{"x2", "->", 
        RowBox[{
         RowBox[{"x3", " ", "or", " ", "x2"}], "->", 
         RowBox[{"x3", "->", 
          RowBox[{
           RowBox[{
            RowBox[{"x1", " ", "but", " ", "not", " ", "x1"}], "<", 
            RowBox[{"-", "x2"}]}], "->", 
           RowBox[{"x3", "."}]}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"subsCanonSeeded", "[", "algSeed_", "]"}], "[", "cluster_", 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "xs", ",", "b", ",", "subIndicesTotal", ",", "subMatrices", ",", 
        "posGood", ",", "subIndicesGood", ",", "ret"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xs", "=", 
        RowBox[{"cluster", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"cluster", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"subIndicesTotal", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Permutations", "/@", 
           RowBox[{"Subsets", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "xs", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", 
               RowBox[{"algSeed", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "}"}]}], "]"}]}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"subMatrices", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"f", "@@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", "#"}], "}"}], "&"}], "/@", 
             "subIndicesTotal"}], ")"}]}], ")"}], "/.", 
         RowBox[{
          RowBox[{"f", "[", "a__", "]"}], "\[RuleDelayed]", 
          RowBox[{"b", "[", 
           RowBox[{"[", "a", "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posGood", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"subMatrices", ",", 
          RowBox[{"algSeed", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"subIndicesGood", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"subIndicesTotal", "[", 
           RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
         RowBox[{"Flatten", "[", "posGood", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ret", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
         RowBox[{"Gather", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xs", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "subIndicesGood"}],
            ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Sort", "[", "#1", "]"}], "\[Equal]", 
             RowBox[{"Sort", "[", "#2", "]"}]}], "&"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.7104990158907146`*^9, 3.7104990168222723`*^9}, {
  3.710514906499134*^9, 3.710514917412438*^9}, {3.710515500614464*^9, 
  3.710515501083991*^9}, {3.710515855024459*^9, 3.710515868355443*^9}, {
  3.710515920138565*^9, 3.710515923086258*^9}, {3.710516599519376*^9, 
  3.71051666131109*^9}, {3.710539729125443*^9, 3.710539729980351*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"algOfRank", "[", 
     RowBox[{"[", "i", "]"}], "]"}], " ", "gives", " ", "a", " ", "list", " ",
     "of", " ", "algebras", " ", "of", " ", "rank", " ", "i"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"algOfRank", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "\"\<a1\>\"", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<a2\>\"", ",", "\"\<a1a1\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<a3\>\"", ",", "\"\<a2a1\>\"", ",", "\"\<a1a1a1\>\""}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<d4\>\"", ",", "\"\<a4\>\"", ",", "\"\<a3a1\>\"", ",", 
        "\"\<a2a2\>\"", ",", "\"\<a2a1a1\>\"", ",", "\"\<a1a1a1a1\>\""}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<d5\>\"", ",", "\"\<a5\>\"", ",", "\"\<d4a1\>\"", ",", 
        "\"\<a4a1\>\"", ",", "\"\<a3a2\>\"", ",", "\"\<a3a1a1\>\"", ",", 
        "\"\<a2a2a1\>\"", ",", "\"\<a2a1a1a1\>\"", ",", 
        "\"\<a1a1a1a1a1\>\""}], "}"}]}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.710497406172803*^9, 3.710497546326357*^9}, 
   3.710497577468033*^9, {3.7104990421139593`*^9, 3.7104990929576387`*^9}, {
   3.710502451361876*^9, 3.710502455161487*^9}, {3.7105447305008173`*^9, 
   3.710544794575676*^9}, {3.7107507540711107`*^9, 3.710750756083968*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"subsCanon", "[", "rank_", "]"}], "[", "cluster_", "]"}], ":=", 
    " ", 
    RowBox[{
    "finds", " ", "subsets", " ", "of", " ", "`cluster`", " ", "that", " ", 
     "are", " ", "in", " ", 
     RowBox[{"the", " ", "'"}], 
     RowBox[{"canonical", "'"}], " ", "form", "\n", "of", " ", "a", " ", 
     "subalgebra", " ", "of", " ", 
     RowBox[{"`rank`", "."}]}]}], "*)"}], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"subsCanon", "[", "type_", "]"}], "[", "cluster_", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{"type", ",", 
      RowBox[{
       RowBox[{"subsCanonSeeded", "[", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "type", "]"}], "<>", "\"\<Seed\>\""}], 
         "]"}], "]"}], "[", "cluster", "]"}]}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.7104989823678083`*^9, 3.710498987961749*^9}, {
   3.7104990238878927`*^9, 3.7104990299428*^9}, {3.710499177941399*^9, 
   3.710499345755514*^9}, 3.710539751624074*^9, {3.710699110154359*^9, 
   3.7106991303818827`*^9}, {3.710699271707247*^9, 3.7106992857581797`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "fullSubStructure", " ", "contains", " ", "a", " ", "list", " ", "of", " ",
     "subpolytopes", " ", "grouped", " ", "in", " ", "to", " ", "equivalence",
     " ", "classes", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"i", ".", "e", ".", " ", "when"}], " ", "multiple", " ", 
       "subpolytopes", " ", "that", " ", "correspond", " ", "to", " ", "the", 
       " ", "same", " ", 
       RowBox[{"subalgebra", ".", " ", "a"}], " ", "note", " ", "on", " ", 
       RowBox[{"speed", ":", " ", 
        RowBox[{
         RowBox[{"for", " ", "everything"}], " ", "<", 
         RowBox[{
         "E6", " ", "this", " ", "code", " ", "is", " ", "pretty", " ", 
          "quick", " ", 
          RowBox[{"(", 
           RowBox[{"<", 
            RowBox[{"1", "sec"}]}], ")"}]}]}]}]}], ",", " ", 
      RowBox[{
       RowBox[{
       "but", " ", "for", " ", "E6", " ", "each", " ", "type", " ", "takes", 
        " ", "5"}], "-", 
       RowBox[{"20", 
        RowBox[{"sec", ".", " ", "I"}], " ", "think", " ", "this", " ", "is", 
        " ", "mostly", " ", "unavoidable"}]}], ",", " ", 
      RowBox[{"as", " ", "E6", " ", "is", " ", "very", " ", "complicated"}], 
      ",", " ", 
      RowBox[{
      "but", " ", "perhaps", " ", "there", " ", "are", " ", "significant", 
       " ", "speed", " ", "improvements", " ", "to", " ", "be", " ", 
       RowBox[{"made", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"fullSubStructure", "[", "type_", "]"}], "[", "clusters_", "]"}],
     ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"fullSubStructure", "[", "type", "]"}], "[", "clusters", "]"}], 
     "=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"groups", ",", "numReplace", ",", "numEval", ",", "base"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"numReplace1", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6"}], 
            "}"}], "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"Prime", "/@", 
             RowBox[{"Range", "[", "6", "]"}]}], ")"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"numReplace2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "x1", ",", "x2", ",", "x3", ",", "x4", ",", "x5", ",", "x6"}], 
            "}"}], "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"Prime", "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Range", "[", "6", "]"}], "+", "6"}], ")"}]}], ")"}]}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"numEval1", "[", 
          RowBox[{"a_String", "[", "x__", "]"}], "]"}], ":=", 
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"a", "<>", "\"\<Xs\>\""}], "]"}], "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "x", "}"}], "/.", "numReplace1"}], ")"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"numEval2", "[", 
          RowBox[{"a_String", "[", "x__", "]"}], "]"}], ":=", 
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"a", "<>", "\"\<Xs\>\""}], "]"}], "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "x", "}"}], "/.", "numReplace2"}], ")"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"base", "=", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "@@@", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"subsCanon", "[", "type", "]"}], "[", "#", "]"}], 
                "}"}]}], ")"}], "&"}], "/@", "clusters"}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"groups", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "#"}], "&"}], "/@", 
          RowBox[{"Gather", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"numEval1", "[", "#", "]"}], ",", 
                RowBox[{"numEval2", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
             "base"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}], "\[Equal]", 
              RowBox[{"#2", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "&"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Sort", "[", 
              RowBox[{"Sort", "/@", 
               RowBox[{"(", 
                RowBox[{"#", "/.", 
                 RowBox[{
                  RowBox[{"a_String", "[", "x__", "]"}], "\[RuleDelayed]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"tmp", "=", 
                    RowBox[{"clusters", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"tmp", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"a", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"tmp", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#", ",", "1"}], 
                    "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
                    RowBox[{"{", "x", "}"}]}], ")"}]}]}], "]"}]}], "]"}], 
                    "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"Intersection", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
                    RowBox[{"Position", "[", 
                    RowBox[{"clusters", ",", "#", ",", "3"}], "]"}]}], "&"}], 
                    "/@", 
                    RowBox[{"{", "x", "}"}]}], ")"}]}], ")"}]}], ")"}]}]}], 
                ")"}]}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "groups"}], ")"}], 
         "]"}], ";"}]}], "]"}]}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.710541183003524*^9, 3.71054121386862*^9}, {
   3.710541365759336*^9, 3.710541391681737*^9}, {3.710541486512273*^9, 
   3.710541501479965*^9}, {3.710541858872566*^9, 3.710541879432124*^9}, {
   3.71054420959369*^9, 3.7105442187740917`*^9}, {3.710544799873678*^9, 
   3.7105448287213497`*^9}, {3.71054512731812*^9, 3.71054516870242*^9}, {
   3.71069614302113*^9, 3.710696156184132*^9}, 3.7106981544221487`*^9, {
   3.7106986261832647`*^9, 3.710698633203261*^9}, {3.710699309183797*^9, 
   3.7106993550486307`*^9}, {3.7106996519760447`*^9, 3.710699656542781*^9}, {
   3.710699786617236*^9, 3.7106997899025087`*^9}, {3.710699858901121*^9, 
   3.7106998722866793`*^9}, 3.710766075172406*^9, {3.7107739620179768`*^9, 
   3.71077397220721*^9}, {3.710774331162722*^9, 3.71077433594556*^9}, {
   3.710776481649145*^9, 3.7107765408411627`*^9}, {3.710776648891409*^9, 
   3.7107766497629147`*^9}, 3.710776975378175*^9, {3.710777944243725*^9, 
   3.710777955041391*^9}, {3.710778016623036*^9, 3.7107780392819357`*^9}, {
   3.710778097215726*^9, 3.7107781332363997`*^9}, {3.710778166347707*^9, 
   3.710778176575841*^9}, {3.710778224730393*^9, 3.7107782357492943`*^9}, {
   3.7107784690328817`*^9, 3.710778471257469*^9}, {3.710779407308827*^9, 
   3.710779617899766*^9}, 3.710779805256118*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "finally", " ", "we", " ", "have", " ", "what", " ", "we", " ", "came", 
    " ", "for"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"subpoly", "[", "type_", "]"}], "[", "clusters_", "]"}], ":=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fullSubStructure", "[", "type", "]"}], "[", "clusters", 
        "]"}], ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"subalg", "[", "type_", "]"}], "[", "clusters_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
      RowBox[{
       RowBox[{"fullSubStructure", "[", "type", "]"}], "[", "clusters", 
       "]"}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.710777757382934*^9, 3.7107777774156837`*^9}, {
  3.710777967607688*^9, 3.710777986799069*^9}, {3.7107780685278254`*^9, 
  3.7107780772403803`*^9}, {3.710778181014286*^9, 3.710778220064911*^9}, {
  3.7107798328601217`*^9, 3.710779838871883*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"let", "'"}], "s", " ", "tabulate", " ", "some", " ", 
   RowBox[{"substructure", "!"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.710779842292542*^9, 3.7107798587147217`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"alg", "=", 
   RowBox[{"a3", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#", ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], "}"}], 
    "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"algOfRank", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"alg", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
     "]"}], "]"}]}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.710699891340225*^9, 3.7106999814245768`*^9}, {
   3.710700026672494*^9, 3.710700053954503*^9}, 3.710700266924893*^9, {
   3.710778553075512*^9, 3.710778571288001*^9}, {3.710778849139241*^9, 
   3.71077886928904*^9}, {3.710779713832181*^9, 3.710779755521785*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "6", "6"},
     {"\<\"a1a1\"\>", "3", "3"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.710779727890708*^9, 3.7107797561896667`*^9}, 
   3.71077997602026*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"alg", "=", 
   RowBox[{"a4", "[", "]"}]}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"#", ",", 
       RowBox[{"Length", "[", 
        RowBox[{
         RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{
         RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], "}"}],
      "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{"algOfRank", "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"alg", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], "]"}],
       "]"}], "]"}]}], "//", "MatrixForm"}]}]], "Input",
 CellChangeTimes->{3.7107797476578407`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "28", "21"},
     {"\<\"a1a1\"\>", "28", "28"},
     {"\<\"a3\"\>", "7", "7"},
     {"\<\"a2a1\"\>", "7", "7"},
     {"\<\"a1a1a1\"\>", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.710779739231683*^9, 3.710779749294991*^9}, 
   3.7107799761271276`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"alg", "=", 
   RowBox[{"d4", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#", ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], "}"}], 
    "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"algOfRank", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"alg", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
     "]"}], "]"}]}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.710699903066958*^9, 3.710699905665538*^9}, {
  3.7107000637647657`*^9, 3.710700064237039*^9}, {3.710779763450142*^9, 
  3.710779763770837*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "36", "36"},
     {"\<\"a1a1\"\>", "30", "18"},
     {"\<\"a3\"\>", "12", "12"},
     {"\<\"a2a1\"\>", "0", "0"},
     {"\<\"a1a1a1\"\>", "4", "4"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.710779765081484*^9, 3.710779976249423*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"alg", "=", 
   RowBox[{"a5", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#", ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], "}"}], 
    "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"algOfRank", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"alg", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
     "]"}], "]"}]}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.710699903066958*^9, 3.710699905665538*^9}, {
  3.7107000637647657`*^9, 3.710700085803742*^9}, {3.710779771525113*^9, 
  3.710779771860965*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "120", "56"},
     {"\<\"a1a1\"\>", "180", "144"},
     {"\<\"a3\"\>", "36", "28"},
     {"\<\"a2a1\"\>", "72", "72"},
     {"\<\"a1a1a1\"\>", "12", "12"},
     {"\<\"d4\"\>", "0", "0"},
     {"\<\"a4\"\>", "8", "8"},
     {"\<\"a3a1\"\>", "8", "8"},
     {"\<\"a2a2\"\>", "4", "4"},
     {"\<\"a2a1a1\"\>", "0", "0"},
     {"\<\"a1a1a1a1\"\>", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.710779775210842*^9, 3.710779977552497*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"alg", "=", 
   RowBox[{"d5", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#", ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], "}"}], 
    "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"algOfRank", "[", 
     RowBox[{"[", 
      RowBox[{"2", ";;", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"alg", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
     "]"}], "]"}]}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.710699903066958*^9, 3.710699905665538*^9}, {
  3.7107000637647657`*^9, 3.710700089482451*^9}, {3.7107797836743507`*^9, 
  3.710779784108096*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "180", "125"},
     {"\<\"a1a1\"\>", "230", "145"},
     {"\<\"a3\"\>", "70", "65"},
     {"\<\"a2a1\"\>", "60", "50"},
     {"\<\"a1a1a1\"\>", "30", "30"},
     {"\<\"d4\"\>", "5", "5"},
     {"\<\"a4\"\>", "10", "10"},
     {"\<\"a3a1\"\>", "5", "5"},
     {"\<\"a2a2\"\>", "0", "0"},
     {"\<\"a2a1a1\"\>", "5", "5"},
     {"\<\"a1a1a1a1\"\>", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.710779797188682*^9, 3.7107799799080267`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"this", " ", 
    RowBox[{"takes", " ", "~", "2.5"}], "min"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"alg", "=", 
     RowBox[{"e6", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"#", ",", 
        RowBox[{"Length", "[", 
         RowBox[{
          RowBox[{"subpoly", "[", "#", "]"}], "[", "alg", "]"}], "]"}], ",", 
        RowBox[{"Length", "[", 
         RowBox[{
          RowBox[{"subalg", "[", "#", "]"}], "[", "alg", "]"}], "]"}]}], 
       "}"}], "&"}], "/@", 
     RowBox[{"Flatten", "[", 
      RowBox[{"algOfRank", "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"alg", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "1"}]}], 
        "]"}], "]"}], "]"}]}], "//", "MatrixForm"}]}]}]], "Input",
 CellChangeTimes->{{3.710699903066958*^9, 3.710699905665538*^9}, {
  3.7107000637647657`*^9, 3.710700064237039*^9}, {3.7107000955367937`*^9, 
  3.710700095906605*^9}, {3.710779869270784*^9, 3.7107798695248117`*^9}, {
  3.710779946531028*^9, 3.710779953244454*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"\<\"a2\"\>", "1071", "504"},
     {"\<\"a1a1\"\>", "1785", "833"},
     {"\<\"a3\"\>", "476", "364"},
     {"\<\"a2a1\"\>", "714", "490"},
     {"\<\"a1a1a1\"\>", "357", "357"},
     {"\<\"d4\"\>", "35", "35"},
     {"\<\"a4\"\>", "112", "98"},
     {"\<\"a3a1\"\>", "112", "112"},
     {"\<\"a2a2\"\>", "21", "14"},
     {"\<\"a2a1a1\"\>", "119", "119"},
     {"\<\"a1a1a1a1\"\>", "0", "0"},
     {"\<\"d5\"\>", "14", "14"},
     {"\<\"a5\"\>", "7", "7"},
     {"\<\"d4a1\"\>", "0", "0"},
     {"\<\"a4a1\"\>", "14", "14"},
     {"\<\"a3a2\"\>", "0", "0"},
     {"\<\"a3a1a1\"\>", "0", "0"},
     {"\<\"a2a2a1\"\>", "7", "7"},
     {"\<\"a2a1a1a1\"\>", "0", "0"},
     {"\<\"a1a1a1a1a1\"\>", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7107800617160807`*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{840, 1002},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
Magnification->1.25,
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 366, 9, 66, "Input"],
Cell[CellGroupData[{
Cell[949, 33, 118, 1, 183, "Title"],
Cell[1070, 36, 2904, 40, 1470, "Input"],
Cell[3977, 78, 4161, 108, 508, "Input"],
Cell[8141, 188, 1374, 32, 144, "Input"],
Cell[9518, 222, 1169, 29, 170, "Input"],
Cell[10690, 253, 8835, 212, 898, "Input"],
Cell[19528, 467, 1127, 30, 118, "Input"],
Cell[20658, 499, 228, 5, 39, "Input"],
Cell[CellGroupData[{
Cell[20911, 508, 1073, 29, 92, "Input"],
Cell[21987, 539, 708, 19, 72, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22732, 563, 829, 26, 92, "Input"],
Cell[23564, 591, 812, 22, 138, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24413, 618, 954, 28, 92, "Input"],
Cell[25370, 648, 784, 21, 138, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26191, 674, 954, 28, 92, "Input"],
Cell[27148, 704, 991, 27, 270, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28176, 736, 956, 28, 92, "Input"],
Cell[29135, 766, 996, 27, 270, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30168, 798, 1254, 35, 118, "Input"],
Cell[31425, 835, 1306, 36, 470, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

